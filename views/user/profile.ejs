<%- include('../partials/header') %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Colonne du profil -->
        <div class="md:col-span-1">
            <div class="bg-white p-6 rounded-lg shadow-md text-center">
                <img class="w-32 h-32 rounded-full mx-auto object-cover border-4 border-gray-200" src="<%= user.profileImageUrl ? user.profileImageUrl : 'https://via.placeholder.com/150' %>" alt="Photo de profil de <%= user.username %>">
                <h2 class="text-2xl font-bold mt-4"><%= user.username %></h2>
                <p class="text-gray-600"><%= user.email %></p>
                <p class="text-sm text-gray-500 mt-2">Membre depuis <%= new Date(user.createdAt).toLocaleDateString('fr-FR') %></p>
            </div>

            <!-- Formulaire de mise à jour du profil -->
            <div class="bg-white p-6 rounded-lg shadow-md mt-6">
                <h3 class="text-xl font-semibold mb-4">Mettre à jour le profil</h3>
                <form action="/profile?_method=PUT" method="POST" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label for="username" class="block text-sm font-medium text-gray-700">Nom d'utilisateur</label>
                        <input type="text" name="username" id="username" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" value="<%= user.username %>">
                    </div>
                    <div class="mb-4">
                        <label for="email" class="block text-sm font-medium text-gray-700">Adresse e-mail</label>
                        <input type="email" name="email" id="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" value="<%= user.email %>">
                    </div>
                    <div class="mb-4">
                        <label for="profileImage" class="block text-sm font-medium text-gray-700">Changer la photo de profil</label>
                        <input type="file" name="profileImage" id="profileImage" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-600 hover:file:bg-indigo-100">
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Enregistrer les modifications</button>
                </form>
            </div>
        </div>

        <!-- Colonne des annonces -->
        <div class="md:col-span-2">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-4">Mes Annonces</h3>

                <!-- Barre d'onglets -->
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs" id="ad-tabs">
                        <button data-tab="approved" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-indigo-500 text-indigo-600">Approuvées (<%= approvedAds.length %>)</button>
                        <button data-tab="pending" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">En attente (<%= pendingAds.length %>)</button>
                        <button data-tab="rejected" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">Rejetées (<%= rejectedAds.length %>)</button>
                    </nav>
                </div>

                <!-- Panneaux de contenu des onglets -->
                <div class="mt-6">
                    <!-- Annonces Approuvées -->
                    <div id="tab-panel-approved" class="tab-panel">
                        <% if (approvedAds.length > 0) { %>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <% approvedAds.forEach(ad => { %>
                                    <%- include('../partials/ad-card', { ad: ad, showStatus: false }) %>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <p class="text-gray-500">Vous n'avez aucune annonce approuvée pour le moment.</p>
                        <% } %>
                    </div>

                    <!-- Annonces En Attente -->
                    <div id="tab-panel-pending" class="tab-panel hidden">
                         <% if (pendingAds.length > 0) { %>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <% pendingAds.forEach(ad => { %>
                                    <%- include('../partials/ad-card', { ad: ad, showStatus: true, statusText: 'En attente' }) %>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <p class="text-gray-500">Vous n'avez aucune annonce en attente de validation.</p>
                        <% } %>
                    </div>

                    <!-- Annonces Rejetées -->
                    <div id="tab-panel-rejected" class="tab-panel hidden">
                         <% if (rejectedAds.length > 0) { %>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <% rejectedAds.forEach(ad => { %>
                                    <%- include('../partials/ad-card', { ad: ad, showStatus: true, statusText: 'Rejetée', statusClass: 'bg-red-100 text-red-800' }) %>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <p class="text-gray-500">Vous n'avez aucune annonce rejetée.</p>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const tabsContainer = document.getElementById('ad-tabs');
    const tabButtons = tabsContainer.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');

    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            // Désactiver tous les boutons
            tabButtons.forEach(btn => {
                btn.classList.remove('border-indigo-500', 'text-indigo-600');
                btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
            });
            // Activer le bouton cliqué
            button.classList.add('border-indigo-500', 'text-indigo-600');
            button.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

            const tab = button.getAttribute('data-tab');

            // Cacher tous les panneaux
            tabPanels.forEach(panel => {
                panel.classList.add('hidden');
            });

            // Afficher le panneau correspondant
            const targetPanel = document.getElementById(`tab-panel-${tab}`);
            if (targetPanel) {
                targetPanel.classList.remove('hidden');
            }
        });
    });
</script>

<%- include('../partials/footer') %>
